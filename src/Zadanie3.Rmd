---
title: 'Semestral Project: Belief network'
author: "David Wagner, Viktor Klíma"
date: "`r format(Sys.Date(), '%d.%m.%Y')`"
output:
  html_document: 
    toc: true
    toc_float: true
  pdf_document:
    toc: true
---

# Introduction

In today's data-driven landscape, understanding the intricate relationships between various factors is vital for effective marketing strategies. Leveraging data analytics, this project aims to construct a discrete Bayesian network to unveil causal relationships between key variables. By asking meaningful questions, we seek to uncover hidden insights that can drive impactful marketing decisions. These insights offer businesses a competitive edge, making investments in data analytics expertise invaluable. Join us as we explore the power of probabilistic modeling to unlock the full potential of data assets.

# Data Loading and Preprocessing

To initiate our analysis, the first step involves loading the dataset into our R environment. This dataset, stored as "ObesityDataSet.csv", encapsulates vital information on obesity levels among individuals from specific Latin American countries. Our analysis begins by setting the working directory to where the dataset is located and subsequently loading the dataset into R for inspection and preprocessing.

```{r load-data, message=FALSE, warning=FALSE}
library(readr)
library(tidyverse)
library(lobstr)
library(dplyr)
library(ggplot2)
library(magrittr)
library(data.table)
library(caret)
library(MASS)
library(purrr)
library(GGally)
library(ggplot2)
library(gplots)
library(pROC)
library(kernlab)
library(stats)
library(e1071)
library(igraph)
library(ggraph)
library(knitr)
library(kableExtra)



# Setting the working directory to where the dataset is located
# Uncomment the appropriate line below to match your directory structure
# setwd("C:/Users/dswag/Desktop/Zadania/OZNAL/Data")
setwd("C:/work/oznal/OZNAL_zadania/Data")

# Listing all files in the current working directory to verify the presence of our dataset
list.files()

# Reading the dataset into R
raw_data <- read_csv("ObesityDataSet.csv", col_names = TRUE, num_threads = 4)

# Displaying the first few rows of the dataset to ensure it's loaded correctly
head(raw_data)


# Renaming columns in the dataset to make them more descriptive
names(raw_data)[names(raw_data) == "FAVC"] <- "FreqConsHighCalFood"
names(raw_data)[names(raw_data) == "FCVC"] <- "FreqConsVegs"
names(raw_data)[names(raw_data) == "NCP"] <- "NumMainMeals"
names(raw_data)[names(raw_data) == "CAEC"] <- "ConsFoodBetwMeals"
names(raw_data)[names(raw_data) == "CH2O"] <- "ConsWaterDaily"
names(raw_data)[names(raw_data) == "CALC"] <- "ConsAlc"
names(raw_data)[names(raw_data) == "SCC"] <- "CalsConsMon"
names(raw_data)[names(raw_data) == "FAF"] <- "PhysActFreq"
names(raw_data)[names(raw_data) == "TUE"] <- "TimeTechDev"
names(raw_data)[names(raw_data) == "MTRANS"] <- "Trans"
names(raw_data)[names(raw_data) == "family_history_with_overweight"] <- "ObesityFam"

cleaned_data <- raw_data

# Clean and standardize the PhysActFreq and FreqConsVegs columns by rounding the values to the nearest whole number
cleaned_data$PhysActFreq <- round(cleaned_data$PhysActFreq)
cleaned_data$PhysActFreq <- pmin(pmax(cleaned_data$PhysActFreq, 0), 3)
cleaned_data$FreqConsVegs <- round(cleaned_data$FreqConsVegs)
cleaned_data$FreqConsVegs <- pmin(pmax(cleaned_data$FreqConsVegs, 0), 3)

# Create categorical factors from PhysActFreq, FreqConsVegs and Age
cleaned_data$PhysActFreq <- ifelse(cleaned_data$PhysActFreq == 0, 'No activity',
                            ifelse(cleaned_data$PhysActFreq == 1, 'Low activity',
                                   ifelse(cleaned_data$PhysActFreq == 2, 'Moderate activity', 'High activity')))

cleaned_data$FreqConsVegs <- ifelse(cleaned_data$FreqConsVegs == 1, 'Low consumption',
                             ifelse(cleaned_data$FreqConsVegs == 2, 'Moderate consumption', 'High consumption'))

cleaned_data <- cleaned_data %>%
  mutate(across(where(is.character), as.factor))

str(cleaned_data)
```

The dataset contains the following columns:

* **Gender**: Categorical (Male, Female)
* **Age**: Categorical (Youth, Young Adult, Middle-Aged Adult, Senior)
* **Height**: Numerical
* **Weight**: Numerical
* **ObesityFam**: Categorical (yes, no)
* **FreqConsHighCalFood**: Categorical (yes, no)
* **FreqConsVegs**: Categorical (Low consumption, Moderate consumption, High consumption)
* **NumMainMeals**: Numerical
* **ConsFoodBetwMeals**: Categorical (Sometimes, Frequently, Always, no)
* **SMOKE**: Categorical (yes, no)
* **ConsWaterDaily**: Numerical
* **CalsConsMon**: Categorical (yes, no)
* **PhysActFreq**: Categorical (No activity, Low activity, Moderate activity, High activity)
* **TimeTechDev**: Numerical
* **ConsAlc**: Categorical (No, Sometimes, Frequently, Always)
* **Trans**: Categorical (Public Transport, Walking, Automobile, Motorbike, Bike)
* **Nobesity**: Categorical (different levels of obesity)

### Nodes

To construct the Bayesian network, we need to select variables that could logically influence each other. Based on the variables available, here's a selection for the nodes in our network:

1. Gender
2. Trans
3. ObesityFam
4. FreqConsHighCalFood
5. FreqConsVegs
6. PhysActFreq
7. CalsConsMon
8. Nobesity (target variable for predictions)

### Relationships

1. Gender -> Nobesity
2. Trans -> Nobesity
3. ObesityFam -> Nobesity
4. FreqConsHighCalFood -> Nobesity
5. FreqConsVegs -> Nobesity
6. PhysActFreq -> Nobesity
7. FreqConsHighCalFood -> FreqConsVegs (Assuming that frequent high caloric food consumption influences vegetable consumption)
8. Trans -> PhysActFreq (Assuming people who transport by Automobile might exercise differently)
9. Gender -> PhysActFreq (Potential differences in physical activity patterns by gender)
10. FreqConsHighCalFood -> PhysActFreq (Diet may influence exercise habits)
11. CalsConsMon -> FreqConsHighCalFood
12. CalsConsMon -> FreqConsVegs

$~$

![](C:/work/oznal/OZNAL_zadania/Data/baysnetw.png) 

$~$

Here is the visual representation of the Bayesian Network based on the relationships we discussed. This graph illustrates how different factors such as Gender, Form of transformation (Trans), family history of overweight (ObesityFam), frequent high caloric food consumption (FreqConsHighCalFood), frequency of vegetable consumption (FreqConsVegs), physical activity frequency (PhysActFreq) and the fact that individual is monitoring his calories (CalsConsMon) are hypothesized to influence obesity levels (Nobesity).

# Sales marketing Questions

### Joint Probability Question
**What is the joint probability of being male, frequently consuming high caloric food, and being classified as Obesity Type II?**
- **Objective**: This question aims to quantify the proportion of the population that is male, consumes high-calorie food frequently, and is classified as Obesity Type II.
- **Application**: Knowing this probability can help businesses and health organizations tailor their nutrition or fitness programs to specifically target men who are most at risk due to their dietary habits. It's particularly useful for creating personalized diet plans or fitness regimens that cater to individuals with high caloric intake.

### Marginal Probability Question
**What is the probability distribution of obesity categories among individuals with a family history of overweight?**
- **Objective**: This seeks to understand how the probability of being in various obesity categories (e.g., Insufficient Weight, Normal Weight, Overweight, Obesity Type I/II/III) is distributed among individuals who have a genetic predisposition to obesity.
- **Application**: The findings from this analysis can be crucial for health marketers and product developers focusing on weight management solutions. It allows for more targeted marketing and product development strategies that consider genetic factors influencing obesity.

### Conditional Probability Questions
1. **Given that an individual is female and frequently consumes alcohol, what is the probability that she falls into the Overweight or Obesity categories?**
   - **Objective**: To determine how alcohol consumption influences weight categories among females.
   - **Application**: This information is valuable for campaigns aimed at women, focusing on the impact of alcohol on weight gain. It can be used to tailor public health messages, develop specific interventions, or market low-calorie alcoholic beverages.

2. **What is the probability of using public transportation given that an individual has a high frequency of consuming vegetables and is classified under Normal Weight?**
   - **Objective**: To investigate the relationship between dietary habits, weight management, and the choice of transportation.
   - **Application**: Insights derived could support urban planning and public transportation policies that promote accessibility to individuals leading a healthy lifestyle. It could also inform marketing strategies for public transport systems in areas with higher populations of health-conscious individuals.

3. **Given that an individual monitors calorie consumption and has a high physical activity frequency, what is the probability that they are not overweight?**
   - **Objective**: To assess the effectiveness of calorie monitoring and frequent physical activity in maintaining a healthy weight.
   - **Application**: This probability can validate the benefits of fitness tracking apps and dietary monitoring tools. It's crucial for companies that develop these technologies to showcase the effectiveness of their products in promoting a healthy lifestyle and preventing overweight and obesity.

These questions, when answered, provide strategic insights that can be leveraged in various ways—from product development and marketing to public health initiatives and policy making. They help in understanding specific subsets of the population, enabling tailored approaches that are likely more effective than broad strategies.

## Defining Probability Distributions

Let's start by calculating probability distributions of each variable 

```{r}
# Calculate probability distributions
prob_gender <- prop.table(table(cleaned_data$Gender))
prob_trans <- prop.table(table(cleaned_data$Trans))
prob_obesityfam <- prop.table(table(cleaned_data$ObesityFam))
prob_FreqConsHighCalFood <- prop.table(table(cleaned_data$FreqConsHighCalFood))
prob_FreqConsVegs <- prop.table(table(cleaned_data$FreqConsVegs))
prob_PhysActFreq <- prop.table(table(cleaned_data$PhysActFreq))
prob_CalsConsMon <- prop.table(table(cleaned_data$CalsConsMon))
prob_ConsAlc <- prop.table(table(cleaned_data$ConsAlc))
prob_nobesity <- prop.table(table(cleaned_data$Nobesity))
```

```{r, echo=FALSE}
# Display the results
kable(prob_gender, caption = "Probability of Gender", col.names = c("", "Probability"), format = "html", table.attr = "style='width:50%;'")  %>%
  kable_styling(position = "left")

kable(prob_trans, caption = "Probability of Form of transportation", col.names = c("", "Probability"), format = "html", table.attr = "style='width:50%;'")  %>%
  kable_styling(position = "left")

kable(prob_obesityfam, caption = "Probability of Family history with overweight", col.names = c("", "Probability"), format = "html", table.attr = "style='width:50%;'")  %>%
  kable_styling(position = "left")

kable(prob_FreqConsHighCalFood, caption = "Probability of Consumtion frequency of high caloric food", col.names = c("", "Probability"), format = "html", table.attr = "style='width:50%;'")  %>%
  kable_styling(position = "left")

kable(prob_FreqConsVegs, caption = "Probability of Consumption frequency of vegetables", col.names = c("", "Probability"), format = "html", table.attr = "style='width:50%;'")  %>%
  kable_styling(position = "left")

kable(prob_PhysActFreq, caption = "Probability of frequency of physical activity", col.names = c("", "Probability"), format = "html", table.attr = "style='width:50%;'")  %>%
  kable_styling(position = "left")

kable(prob_CalsConsMon, caption = "Probability of monitoring calorie intake", col.names = c("", "Probability"), format = "html", table.attr = "style='width:50%;'")  %>%
  kable_styling(position = "left")

kable(prob_nobesity, caption = "Probability of Obesity", col.names = c("", "Probability"), format = "html", table.attr = "style='width:50%;'")  %>%
  kable_styling(position = "left")

kable(prob_ConsAlc, caption = "Probability of consumtion of alcohol", col.names = c("", "Probability"), format = "html", table.attr = "style='width:50%;'")  %>%
  kable_styling(position = "left")
```

## Calculations

### 1) Joint Probability
> What is the joint probability of being male, frequently consuming high caloric food, and being classified as Obesity Type II?

![](C:/work/oznal/OZNAL_zadania/Data/vypocet1/vypocet1-1.png)

**0.0626056**

This probability indicates the likelihood of an individual meeting all three conditions simultaneously: being male, frequently consuming high-caloric food, and being classified as Obesity Type II. It suggests that there is a moderate chance of observing such individuals within the population.

For marketing purposes, it suggests potential target segments that may be interested in products or services related to managing obesity, such as weight loss programs, dietary supplements, or fitness equipment.

### 2) Marginal Probability
> What is the probability distribution of obesity categories among individuals with a family history of overweight?

![](C:/work/oznal/OZNAL_zadania/Data/vypocet2/vypocet2-1.png)

The provided probabilities represent the distribution of different obesity categories among individuals who have a family history of overweight. Each probability corresponds to the likelihood of an individual falling into a specific obesity category given their family history of overweight. For example, the highest probability (0.1359517) suggests that Normal Weight is the most common obesity category among individuals with a family history of overweight.

Understanding the distribution of obesity categories within this group allows marketers to prioritize their efforts. For example, if Normal Weight individuals constitute the majority, marketing efforts may focus on preventive health measures or products catering to maintaining a healthy weight.

### 3) Conditional Probability
> Given that an individual is female and frequently consumes alcohol, what is the probability that she falls into the Overweight or Obesity categories?

![](C:/work/oznal/OZNAL_zadania/Data/vypocet3/vypocet3-1.png)
![](C:/work/oznal/OZNAL_zadania/Data/vypocet3/vypocet3-2.png)

**0.7351970**

This probability indicates the likelihood of an individual, who is female and frequently consumes alcohol, falling into the Overweight or Obesity categories. It suggests a relatively high probability, implying that females who frequently consume alcohol are more likely to be classified as Overweight or Obese.

Marketers can use this insight to tailor messaging or develop products targeting this specific segment, such as low-calorie alcoholic beverages or fitness programs aimed at weight management.

### 4) Conditional Probability
>What is the probability of using public transportation given that an individual has a high frequency of consuming vegetables and is classified under Normal Weight?

![](C:/work/oznal/OZNAL_zadania/Data/vypocet4/vypocet4-1.png)
![](C:/work/oznal/OZNAL_zadania/Data/vypocet4/vypocet4-2.png)


**0.6006884**

This probability represents the likelihood of an individual using public transportation given that they have a high frequency of consuming vegetables and are classified under Normal Weight. It suggests that there is a moderate chance that individuals meeting these conditions prefer public transportation as their mode of commuting.

Marketers can target this segment with advertisements for eco-friendly products or services, such as sustainable transportation options or environmentally conscious brands.

### 5) Conditional Probability
>Given that an individual monitors calorie consumption and has a high physical activity frequency, what is the probability that they are not overweight?

![](C:/work/oznal/OZNAL_zadania/Data/vypocet5/vypocet5-1.png)
![](C:/work/oznal/OZNAL_zadania/Data/vypocet5/vypocet5-2.png)
![](C:/work/oznal/OZNAL_zadania/Data/vypocet5/vypocet5-3.png)

**0.0869251**

This probability indicates the likelihood of an individual, who monitors calorie consumption and has a high frequency of physical activity, not being overweight. It suggests a relatively low probability, implying that even with these healthy lifestyle habits, there's still a considerable chance of being overweight.

Marketers can use this insight to position their products or services as complementary to a healthy lifestyle rather than solely focusing on weight loss. For example, promoting fitness gear or nutrition supplements as aids in maintaining overall health and well-being.

# Conlusion

**Segment Identification and Prioritization**: Understanding the likelihood of specific consumer characteristics or behaviors allows marketers to identify potential target segments and prioritize their marketing efforts accordingly. By focusing on segments with higher probabilities of certain traits or behaviors, marketers can allocate resources more effectively to reach the most receptive audience.

**Segment Targeting and Tailored Messaging**: The probabilities provide insights into the preferences and behaviors of different consumer segments. Marketers can use this information to tailor their messaging and develop targeted campaigns that resonate with specific audience segments. By addressing the unique needs and preferences of each segment, marketers can increase the effectiveness of their marketing efforts and enhance consumer engagement.

**Behavioral Targeting and Product Positioning**: Understanding the relationship between consumer behaviors and outcomes enables marketers to target specific segments more effectively and position their products or services accordingly. By aligning marketing strategies with consumer behaviors and preferences, marketers can create more compelling value propositions and differentiate their offerings in the market.

Overall, these probabilities offer valuable insights that can inform marketing strategies and decision-making processes. By leveraging this data effectively, marketers can optimize their efforts, maximize their return on investment, and better meet the needs and preferences of their target audience.